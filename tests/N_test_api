import requests

BASE_URL = "http://localhost:8000/api/v1/predict"

def test_valid_input():
    payload = {"texts": ["I'm really disappointed. The service was terrible and slow."]}
    response = requests.post(BASE_URL, json=payload)
    assert response.status_code == 200
    data = response.json()
    assert "predictions" in data
    assert isinstance(data["predictions"], list)

def test_empty_input():
    payload = {"texts": []}
    response = requests.post(BASE_URL, json=payload)
    assert response.status_code == 400  # hoặc 422 tùy framework
    assert "error" in response.json()

def test_missing_texts_key():
    payload = {"wrong_key": ["test"]}
    response = requests.post(BASE_URL, json=payload)
    assert response.status_code == 422  # hoặc 400
    assert "detail" in response.json()

def test_invalid_method():
    response = requests.get(BASE_URL)
    assert response.status_code == 405

def test_non_string_input():
    payload = {"texts": [12345, None]}
    response = requests.post(BASE_URL, json=payload)
    assert response.status_code in [400, 422]
