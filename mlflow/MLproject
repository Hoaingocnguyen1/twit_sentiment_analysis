name: sentiment-analysis

conda_env: conda.yaml
# docker_env:
#   image: Dockerfile

entry_points:
  train:
    parameters:
      model_name: {type: str, default: "answerdotai/ModernBERT-base"}
      version: {type: str, default: "v1.0.0"}
      train_texts: {type: str, default: "artifact/data/X_train.csv"}
      train_labels: {type: str, default: "artifact/data/y_train.csv"}
      eval_texts: {type: str, default: "artifact/data/X_test.csv"}
      eval_labels: {type: str, default: "artifact/data/y_test.csv"}
      epochs: {type: int, default: 3}
      batch_size: {type: int, default: 16}
      learning_rate: {type: float, default: 5e-05}
      finetune: {type: bool, default: True}
      experiment_name: {type: str, default: "sentiment-analysis"}
    command: >
      python scripts/train.py --model-name {model_name} --version {version} --train-texts {train_texts} --train-labels {train_labels} --eval-texts {eval_texts} --eval-labels {eval_labels} --epochs {epochs} --batch-size {batch_size} --learning-rate {learning_rate} --finetune {finetune} --experiment-name {experiment_name}

  validate:
    parameters:
      model_name: {type: str, default: "distilbert-base-uncased"}
      version: {type: str, default: ""}
      stage: {type: str, default: "Staging"}
      eval_texts: {type: str, default: "artifact/data/X_test.csv"}
      eval_labels: {type: str, default: "artifact/data/y_test.csv"}
      batch_size: {type: int, default: 32}
      experiment_name: {type: str, default: "model-validation"}
      promote_to_prod: {type: bool, default: True}
      min_accuracy: {type: float, default: 0.7}
    command: >
      python scripts/validate.py --model-name {model_name} --version {version} --stage {stage} --eval-texts {eval_texts} --eval-labels {eval_labels} --batch-size {batch_size} --experiment-name {experiment_name} --promote-to-prod {promote_to_prod} --min-accuracy {min_accuracy}

  # serve:
  #   parameters:
  #     model_name: {type: str}
  #     version: {type: str, default: null}
  #     stage: {type: str, default: "Production"}
  #     host: {type: }
  #     port: {type: int, default: 8000}
  #   command: >
  #     python sentiment_api/app/main.py
  #       --model_name {model_name}
  #       --version {version}
  #       --stage {stage}
  #       --host {host}
  #       --port {port}


  hf_baseline:
    parameters:
      model_name: {type: string, default: "roberta-baseline"}
      hf_model_name: {type: string, default: "cardiffnlp/twitter-xlm-roberta-base-sentiment"}
      version: {type: string, default: "v1.0.0"}
      texts_file: {type: string, default: "artifact/data/X_test.csv"}
      labels_file: {type: string, default: "artifact/data/y_test.csv"}
      batch_size: {type: int, default: 32}
      experiment_name: {type: string, default: "sentiment-analysis"}
    command: "python scripts/hf_baseline.py --model-name {model_name} --hf-model-name {hf_model_name} --version {version} --texts-file {texts_file} --labels-file {labels_file} --batch-size {batch_size} --experiment-name {experiment_name}"